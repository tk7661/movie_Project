## ì˜í™” ì˜ˆë§¤ ë° ë¦¬ë·° ì‚¬ì´íŠ¸ ì œì‘ í”„ë¡œì íŠ¸(â—'â—¡'â—)

>ë³¸ í”„ë¡œì íŠ¸ëŠ” cgv í™ˆí˜ì´ì§€ë¥¼ ì°¸ê³ í•˜ì—¬ ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.

 [ğŸš— cgv.co.kr](https://www.cgv.co.kr) 


## ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒğŸ«  

<img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white"> <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white"> <img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white"> 
 <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black"> 
<img src="https://img.shields.io/badge/jquery-0769AD?style=for-the-badge&logo=jquery&logoColor=white">
<br>
<img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white"> 
<img src="https://img.shields.io/badge/oracle-F80000?style=for-the-badge&logo=oracle&logoColor=white"> 
<img src="https://img.shields.io/badge/bootstrap-7952B3?style=for-the-badge&logo=bootstrap&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">


## ê°œë°œ ê¸°ê°„ 

2022.04.28- 2022.06.10 (6ì£¼)

## í”„ë¡œì íŠ¸ ì‹¤í–‰ğŸš

í”„ë¡œì íŠ¸ ë‚´ë¶€ì— ìˆëŠ” Wallet_Ezenac1 í´ë”ë¥¼ Cë“œë¼ì´ë¸Œì— ë‘ê³  ì‹¤í–‰í•´ì•¼ ì •ìƒ ì‘ë™ë©ë‹ˆë‹¤.

##  ì£¼ìš” ê¸°ëŠ¥ ğŸ±â€ğŸ
### client
   1. íšŒì›ê°€ì… 
      -    IDì¤‘ë³µí™•ì¸
      -    ì´ë©”ì¼ ì¸ì¦
   2. ë¡œê·¸ì¸
   3. ë§ˆì´í˜ì´ì§€
      -    íšŒì› ì •ë³´ ìˆ˜ì •
      -    íšŒì› íƒˆí‡´ í•˜ê¸°
      -    ì˜ˆë§¤ ë‚´ì—­ ë³´ê¸°
      -    ë¦¬ë·° ê´€ë¦¬(ìˆ˜ì •/ì‚­ì œ)
      -    ë¬¸ì˜ ë‚´ì—­ ë³´ê¸°, ë‹µë³€ í™•ì¸
   4. ì˜í™” ì˜ˆë§¤ í•˜ê¸°
      -    ì˜í™” ,ê·¹ì¥, ì‹œê°„,ì¢Œì„ ì„ íƒ
      -    ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ
      -    ì„ íƒ ì¢Œì„ ì²˜ë¦¬
      -    ì˜ˆì•½ ì¢Œì„ ì²˜ë¦¬
   5. ì˜í™” ë¦¬ë·° ì‘ì„±
      -    ë¦¬ë·°,ë³„ì  ì‘ì„±
      -    ìˆ˜ì •
      -    ì‚­ì œ
      -    ì‹ ê³  í•˜ê¸°
      -    ì¶”ì²œ í•˜ê¸°
   6. ë¬¸ì˜í•˜ê¸°
      -    ë¬¸ì˜ ì‘ì„±
      -    íŒŒì¼ ì—…ë¡œë“œ
### admin
   1. ì˜í™” ê´€ë¦¬ 
      -    ì˜í™” ë“±ë¡
      -    ìˆ˜ì •
      -    ì‚­ì œ
   2. íšŒì› ê´€ë¦¬
      -    íšŒì› ì •ë³´ ë³´ê¸°
      -    ì˜ˆë§¤ ë‚´ì—­
      -    ë¦¬ë·° ë‚´ì—­
      -    ë¬¸ì˜ ë‚´ì—­
      -    íšŒì› ì •ì§€
      -    íšŒì› íƒˆí‡´
   3. ë¬¸ì˜ ê´€ë¦¬
      -    ë¬¸ì˜ ì‚­ì œ
      -    ë‹µë³€ ì‘ì„±
      -    íŒŒì¼ ë‹¤ìš´ë¡œë“œ
   4. ë¦¬ë·° ê´€ë¦¬
      -    ë¦¬ë·° ìˆ˜ì •
      -    ì‚­ì œ
   5. ì‹ ê³  ì²˜ë¦¬(ë¯¸í¡)
      -    ì‹ ê³  ìœ ì € ì •ì§€ ê¸°ê°„ ì„¤ì •
      -    ì‹ ê³  ì‚­ì œ
      -    ì‹ ê³  ì¤‘ë³µ ì²˜ë¦¬ , ê²½ê³  ê¸°ëŠ¥ (ë¯¸ì™„ì„±)
<br>  

 --- 
 
## ì£¼ìš” ì½”ë“œğŸ‘€

### ì¹´ì¹´ì˜¤ ê²°ì œ api 
> ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œë¥¼ êµ¬í˜„í•˜ë©° í•´ë‹¹ ì½”ë“œì˜ íë¦„ì„ ì´í•´í•˜ëŠ”ë° ìˆ˜ì›”í–ˆìŒ. <br>
iamport í™ˆí˜ì´ì§€ì—ì„œ ë¯¸ë¦¬ ë¶€ì—¬ ë°›ì€ ì½”ë“œë¥¼ ì´ìš©í–ˆë‹¤.
 ```js
 $(function(){
        var IMP = window.IMP; 
        IMP.init('imp33034326'); 
        var msg;
        
        IMP.request_pay({
            pg : 'kakaopay',
            pay_method : 'card',
            merchant_uid : 'merchant_' + new Date().getTime(),
            name : '<%=ticket.getTitle()%> <%=ticket.getPerson()%>ë§¤',
             amount : <%=ticket.getPrice()%>,
          
        }, function(rsp) {
            if ( rsp.success ) {             
                jQuery.ajax({
                    url: "/payments/complete", //cross-domain errorê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì£¼ì„¸ìš”
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        imp_uid : rsp.imp_uid
                        //ê¸°íƒ€ í•„ìš”í•œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€ ì „ë‹¬
                    } '''ìƒëµ
```
---

### íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ 
>ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ì—…ë¡œë“œë¥¼ í•´ë„ í”„ë¡œì íŠ¸ í´ë”ì— í•´ë‹¹ íŒŒì¼ì´ ë³´ì´ì§€ ì•Šì•„ í—¤ë§¸ë‹¤.
<br>í†°ì¼“ ì„œë²„ ì„¤ì •ì—ì„œ publishing ì„¤ì • í›„ í•´ê²°ë˜ì—ˆìŒ.

```java
@PostMapping("/qnaWrite.do")
	public String qnaWirteDo(@ModelAttribute QnaBoard qna, @RequestParam MultipartFile file, HttpSession session) throws IllegalStateException, IOException{
		String uploadDir = session.getServletContext().getRealPath("/resources/upload/"+qna.getUserid()+"/");
		String fileName = file.getOriginalFilename();
		File dir = new File(uploadDir);
		if(!dir.exists()) {
			dir.mkdirs();
		}
		if(fileName.equals("")) {
			qna.setFileName("");
		}else {		
			qna.setFileName(fileName);
			System.out.println(qna.getFileName());
			file.transferTo(new File(uploadDir,fileName));
		}
		System.out.println(uploadDir);
		System.out.println(fileName);
		QnaDAO qdao = new QnaDAO();
		qdao.insertQna(qna);
		
		return "redirect:/myPage?userid="+qna.getUserid();
	}
```
<br>

### íŒŒì¼ ë‹¤ìš´ë¡œë“œ 

```java
@GetMapping("/download")
	public void download(HttpSession session,HttpServletRequest request, HttpServletResponse response) throws IOException {
		String userid=request.getParameter("userid");
		String fileName=request.getParameter("fileName");
		System.out.println(userid);
		System.out.println(fileName);
		String path = session.getServletContext().getRealPath("/resources/upload/"+userid+"/"+fileName);
		byte[] fileByte = FileUtils.readFileToByteArray(new File(path));
		response.setContentType("application/octet-stream");
	    response.setHeader("Content-Disposition", "attachment; fileName=\"" + URLEncoder.encode(fileName, "UTF-8")+"\";");
	    response.setHeader("Content-Transfer-Encoding", "binary");

	    response.getOutputStream().write(fileByte);
	    response.getOutputStream().flush();
	    response.getOutputStream().close();
	}
```
###  í˜ì´ì§• ì²˜ë¦¬ ì½”ë“œ js, java
```js

$.ajax({
				type : "post",
					url : "reviewPaging",
					data : {
						pageNum : pageNum,
						code : code,
						sort : sort
					},
					async: true,
					dataType : 'json',
					beforeSend : function(xhr){
						$(".wrap-loading").removeClass('display-none');
						$.blockUI({ message: null });Â 
					},
					complete : function(){
						$.ajax({
							type : "POST",
							url : "reviewBoard",
							async : false,
							dataType : "html",
							cache : false,
							success : function(data2) {
								$("#checkout").children().remove();
								$('#checkout').html(data2);
								$(".wrap-loading").addClass('display-none');Â 
								$.unblockUI();
								var cur=pageNum; //ì„ íƒí•œ í˜ì´ì§€ ë§í¬ ì œê±°
								$("#"+cur).remove('href');
							}
						});
					}
			});
```

```java
@PostMapping("/reviewPaging")
	@ResponseBody
	public void reviewList(String pageNum,int code,int sort,HttpSession session) {
	
		
		Double currentPage = Double.parseDouble(pageNum);
		ReviewDAO rdao = new ReviewDAO();
		int totalData = rdao.countReview(code);
		int pageCount =10;
		Double dataPerPage=6.0;
		int totalPage=(int)Math.ceil(totalData / dataPerPage);
		
		int start = 1+(Integer.parseInt(pageNum)-1)*6;
		int end =(int)(dataPerPage*currentPage);
		if(totalData%6 !=0 && currentPage ==totalPage) {
			end=totalData;
		}

		if(totalPage<pageCount) {
			pageCount=totalPage;
		}
		
		ArrayList<ReviewVo> rlist=rdao.allReview(code, start, end,sort);
		int rcount=rlist.size()/2;
		if(rlist.size()%2==0&&rlist.size()!=0) {
			rcount--;
		}
		
		int pageGroup =(int)Math.ceil(currentPage / pageCount); // í˜ì´ì§€ ê·¸ë£¹
		int last = pageGroup * pageCount; //í™”ë©´ì— ë³´ì—¬ì§ˆ ë§ˆì§€ë§‰ í˜ì´ì§€ ë²ˆí˜¸
		if(last>totalPage) {
			last=totalPage;
		}
		
		int first = (pageGroup-1)*pageCount+1;
		
		int next = last+1;
		int prev = first-1;
		 if(totalData ==0){
			  first=1;
			  prev=0;
		 }
		 
		 session.setAttribute("rlist", rlist);
		 session.setAttribute("rcount", rcount);
		 session.setAttribute("currentPage", currentPage);
		 session.setAttribute("totalData", totalData);
		 session.setAttribute("pageCount", pageCount);
		 session.setAttribute("totalPage", totalPage);
		 session.setAttribute("pageGroup", pageGroup);
		 session.setAttribute("last", last);
		 session.setAttribute("first", first);
		 session.setAttribute("next", next);
		 session.setAttribute("prev", prev);	
	}
```
<br>

### í˜ì´ì§•ì²˜ë¦¬ğŸ˜‚
<br>

í˜ì´ì§• ì²˜ë¦¬ë¥¼ êµ¬í˜„í•  ë•Œ ì›¹í˜ì´ì§€ì˜ ì´ë™ ì—†ì´ ì²˜ë¦¬í•˜ê³  ì‹¶ì—ˆëŠ”ë°  ë°©ë²•ì„ ëª°ë¼ í—¤ë§¤ë‹¤<br>

ajaxí†µì‹ ì´ë€ê±¸ ì•Œê²Œë˜ê³   **ajax** ì™€ **session**ì„ ì´ìš©í•˜ì—¬ êµ¬í˜„í•˜ì˜€ë‹¤.<br>

í˜ì´ì§•ë²ˆí˜¸ í´ë¦­ì‹œ ajax í†µì‹ ìœ¼ë¡œ í•´ë‹¹ ë²ˆí˜¸ë¥¼ ë„˜ê²¨ ì£¼ì–´ ë¯¸ë¦¬ êµ¬í˜„í•œ ì½”ë“œë¥¼ ì´ìš©í•´ sessionì„ ì €ì¥<br>

htmlì— í•´ë‹¹ session ê°’ì„ ë¿Œë ¤ì£¼ì–´ í˜ì´ì§• ì²˜ë¦¬ë¥¼ êµ¬í˜„<br>

ì´í›„ í•œë²ˆ êµ¬í˜„í•´ë†“ì€ ì½”ë“œë¥¼ ì´ìš©í•˜ì—¬ ì—¬ëŸ¬ ë°©ë©´ì—ì„œ ì´ìš©í•˜ì˜€ë‹¤.


### ì¢Œì„ì²˜ë¦¬ğŸª‘
ì•„ë˜ ë§í¬ ì°¸ê³  <br>

[ì„ íƒí•œ ì¢Œì„ì²˜ë¦¬ js ğŸš—](https://github.com/Geun-Hwan/Movie_Project/blob/master/WebContent/resources/js/seat.js)   

[ì˜ˆì•½ëœ ì¢Œì„ì²˜ë¦¬ js ğŸš— ](https://github.com/Geun-Hwan/Movie_Project/blob/master/WebContent/resources/js/ticket.js)   


